// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

enum RegistrationStatus {
  PENDING
  REGISTERED
  REJECTED // Opsional, untuk masa depan jika Anda ingin menolak permintaan
}

enum SbtStatus {
  PENDING
  APPROVED
  CLAIMED
  REJECTED
}

// GANTI InstitutionRequest & InstitutionList DENGAN INI
model Institution {
  id              Int      @id @default(autoincrement())
  name            String
  officialWebsite String
  contactEmail    String
  institutionType Int
  walletAddress   String   @unique
  createdAt       DateTime @default(now())

  // Kolom baru yang krusial
  status             RegistrationStatus @default(PENDING)
  registrationTxHash String?
  registeredAt       DateTime?
  SbtMint            SbtMint?
}

model SbtMint {
  id            String      @id @default(cuid())
  institutionId Int         @unique // Pastikan setiap institusi hanya bisa punya satu permintaan SBT
  institution   Institution @relation(fields: [institutionId], references: [id])
  status        SbtStatus   @default(PENDING)

  tokenId        Int?      @unique
  uri            String?
  approvalTxHash String?
  approvedAt     DateTime?

  claimTxHash String?
  claimedAt   DateTime?

  requestTxHash String? // Simpan bukti permintaan on-chain
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}
